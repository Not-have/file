# ä¸€ã€æ¨¡å—åŒ–è®¤è¯†

äº‹å®ä¸Šæ¨¡å—åŒ–å¼€å‘æœ€ç»ˆçš„ç›®çš„æ˜¯å°†ç¨‹åºåˆ’åˆ†æˆä¸€ä¸ªä¸ªå°çš„ç»“æ„ï¼Œè¿™ä¸ªç»“æ„ä¸­ç¼–å†™å±äºè‡ªå·±çš„é€»è¾‘ä»£ç ï¼Œæœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„ç»“æ„ï¼Œè¿™ä¸ªç»“æ„å¯ä»¥å°†è‡ªå·±å¸Œæœ›æš´éœ²çš„å˜é‡ã€å‡½æ•°ã€å¯¹è±¡ç­‰å¯¼å‡ºç»™å…¶ç»“æ„ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŸç§æ–¹å¼ï¼Œå¯¼å…¥å¦å¤–ç»“æ„ä¸­çš„å˜é‡ã€å‡½æ•°ã€å¯¹è±¡ç­‰ã€‚

æ³¨ï¼šæ—©æœŸæ²¡æœ‰æ¨¡å—åŒ–å¸¦æ¥äº†å¾ˆå¤šçš„é—®é¢˜ï¼šæ¯”å¦‚å‘½åå†²çªçš„é—®é¢˜ã€‚

`ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œä¸åº”è¯¥åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œå†™å¤šä¸ªæ¨¡å—ï¼ˆå°±ç®—è¿™ä¸ªæ¨¡å—åªæœ‰ä¸€è¡Œä»£ç ï¼Œä»–ä¹Ÿç‹¬ç«‹æˆä»¶ï¼‰ã€‚`

## 1ã€æ¨¡å—åŒ–è§„èŒƒ

æ³¨ï¼šES6ï¼ˆ2015ï¼‰æ¨å‡ºäº†[æ¨¡å—åŒ–æ–¹æ¡ˆ](https://hijiangtao.github.io/2019/08/25/JavaScript-Module-Definitions-and-Webpack-Configurations-Notes/)ã€‚

<strike>[AMD](https://www.ruanyifeng.com/blog/2012/10/asynchronous_module_definition.html)</strike>

<strike>CMD</strike>

[CommonJS](https://nodejs.cn/api/modules.html#%E6%A8%A1%E5%9D%97commonjs-%E6%A8%A1%E5%9D%97) ç®€ç§°ä¸º CJS

[ES Modules](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules)

æ³¨ï¼šCommonJS ä¸»è¦åœ¨ node ä¸­ä½¿ç”¨ï¼Œ<strike>AMDã€CMD</strike> åŸºæœ¬ä¸Šé€€å‡ºèˆå°ï¼Œ<u>`ES Modules` æ˜¯ä¸»æµ</u>ã€‚

## 2ã€æ²¡æœ‰æ¨¡å—åŒ–æ—¶ï¼Œå®ç°æ¨¡å—åŒ–ä»£ç 

<strike>[demo](https://github.com/Not-have/practise/blob/main/js/%E6%A8%A1%E5%9D%97%E5%8C%96/%E6%B2%A1%E6%9C%89%E6%A8%A1%E5%9D%97%E5%8C%96/index.html)</strike>

# äºŒã€CommonJS

## 1ã€CommonJS è§„èŒƒå’Œ Node å…³ç³»

CommonJS æ˜¯ä¸€ä¸ªè§„èŒƒï¼Œæœ€åˆæå‡ºæ¥æ˜¯åœ¨æµè§ˆå™¨ä»¥å¤–çš„åœ°æ–¹ä½¿ç”¨ï¼Œå¹¶ä¸”å½“æ—¶è¢«å‘½åä¸º ServerJSï¼Œåæ¥ä¸ºäº† ä½“ç°å®ƒçš„å¹¿æ³›æ€§ï¼Œä¿®æ”¹ä¸º CommonJSï¼Œå¹³æ—¶æˆ‘ä»¬ä¹Ÿä¼šç®€ç§°ä¸º CJSã€‚

1ï¼‰Node æ˜¯ CommonJS åœ¨æœåŠ¡å™¨ç«¯ä¸€ä¸ªå…·æœ‰ä»£è¡¨æ€§çš„å®ç°

2ï¼‰Browserify æ˜¯ CommonJS åœ¨æµè§ˆå™¨ä¸­çš„ä¸€ç§å®ç°

3ï¼‰webpack æ‰“åŒ…å·¥å…·å…·å¤‡å¯¹CommonJS çš„æ”¯æŒå’Œè½¬æ¢

4ï¼‰åœ¨ Node ä¸­æ¯ä¸€ä¸ª js æ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—

5ï¼‰æ¨¡å—ä¸­åŒ…æ‹¬ CommonJS è§„èŒƒçš„æ ¸å¿ƒå˜é‡ï¼šexportsã€module.exportsã€require

6ï¼‰CommonJS ä¸­å¯¼å‡ºä½¿ç”¨ï¼šexports å’Œ module.exports

7ï¼‰CommonJS ä¸­å¯¼å…¥ä½¿ç”¨ï¼šrequire å‡½æ•°

## 2ã€å†…éƒ¨åŸç†



## 3ã€CommonJS æ¡ˆä¾‹

### 1ï¼‰module.exports

![image-20240205025917892](https://not-have.github.io/file/images/image-20240205025917892.png)

ç†è§£ï¼š

![image-20240205235253940](https://not-have.github.io/file/images/image-20240205235253940.png)

### 2ï¼‰exports

![image-20240206001851394](https://not-have.github.io/file/images/image-20240206001851394.png)

æ³¨ï¼šæœ€åå¯¼å‡ºçš„æ—¶å€™ï¼Œä¸€å®šç”¨çš„æ˜¯ module.exportsã€‚

### 3ï¼‰require

[æ–‡æ¡£](https://nodejs.cn/dist/latest-v14.x/docs/api/modules.html#modules_all_together)

require æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚

â‘  å¯¼å…¥æ ¼å¼

require(X)

â‘¡ require å¯¼å…¥æ ¸å¿ƒæ¨¡å—

```javascript
const path = require("path");
const fs = require("fs");
```

[æ–‡æ¡£](https://nodejs.cn/api/)

â‘¢ å¯¼å…¥æ–‡ä»¶

æŸ¥æ‰¾é¡ºåºï¼šX.js > X.json > X.nodeæ–‡ä»¶ > ç›®å½• > X/index.js  > X/index.json > X/index.nodeæ–‡ä»¶

å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆæŠ¥é”™ï¼šnot foundã€‚

â‘£ ä¸æ˜¯ä¸€ä¸ªXï¼ˆæ²¡æœ‰è·¯å¾„ï¼‰ï¼Œå¹¶ä¸”Xä¸æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—çš„æŸ¥æ‰¾é¡ºåº

```javascript
console.log(module);
```

![image-20240206005411230](https://not-have.github.io/file/images/image-20240206005411230.png)

## 4ã€æ¨¡å—åŠ è½½è¿‡ç¨‹

â‘  æ¨¡å—åœ¨è¢«ç¬¬ä¸€æ¬¡å¼•å…¥æ—¶ï¼Œæ¨¡å—ä¸­çš„jsä»£ç ä¼šè¢«è¿è¡Œä¸€æ¬¡ï¼Œå› ä¸ºåªè¦ require äº†ï¼Œæ–‡ä»¶é‡Œé¢çš„ä»£ç å°±ä¼šåŠ è½½éƒ½ç¼“å­˜ä¸­å»äº†

â‘¡ æ¨¡å—è¢«å¤šæ¬¡å¼•å…¥æ—¶ï¼Œä¼šç¼“å­˜ï¼Œæœ€ç»ˆåªåŠ è½½ï¼ˆè¿è¡Œï¼‰ä¸€æ¬¡ï¼ˆæ¯ä¸ªæ¨¡å—å¯¹è±¡ module éƒ½æœ‰ä¸€ä¸ªå±æ€§ loadedï¼Œç”¨æ¥è®°å½•æ˜¯å¦åŠ è½½è¿‡ï¼‰

â‘¢ æ¨¡å—ä¸å»ºè®®å¾ªç¯å¼•ç”¨

â‘£ Node é‡‡ç”¨çš„æ˜¯æ·±åº¦ä¼˜å…ˆç®—æ³•

## 5ã€ç¼ºç‚¹

`CommonJS åŠ è½½æ¨¡å—æ˜¯åŒæ­¥çš„`

åŒæ­¥çš„æ„å‘³ç€åªæœ‰ç­‰åˆ°å¯¹åº”çš„æ¨¡å—åŠ è½½å®Œæ¯•ï¼Œå½“å‰æ¨¡å—ä¸­çš„å†…å®¹æ‰èƒ½è¢«è¿è¡Œï¼Œè¿™ä¸ªåœ¨æœåŠ¡å™¨ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºæœåŠ¡å™¨åŠ è½½çš„jsæ–‡ä»¶éƒ½æ˜¯æœ¬åœ°æ–‡ä»¶ï¼ŒåŠ è½½é€Ÿåº¦éå¸¸å¿«ï¼›ä½†æ˜¯æµè§ˆå™¨åŠ è½½ js æ–‡ä»¶éœ€è¦å…ˆä»æœåŠ¡å™¨å°†æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œä¹‹åå†åŠ è½½è¿è¡Œï¼Œé‚£ä¹ˆé‡‡ç”¨åŒæ­¥çš„å°±æ„å‘³ç€åç»­çš„jsä»£ç éƒ½æ— æ³•æ­£å¸¸è¿è¡Œï¼Œå³ä½¿æ˜¯ä¸€äº›ç®€å•çš„ DOM æ“ä½œï¼›æ‰€ä»¥ä½¿ç”¨ CommonJS çš„æ—¶å€™ï¼Œéƒ½æ˜¯ç”¨ webpackè½¬æˆæµè§ˆå™¨å¯ä»¥ç›´æ¥æ‰§è¡Œçš„ä»£ç ï¼ˆæ—©æœŸä¸ºäº†å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨æ¨¡å—åŒ–ï¼Œé€šå¸¸ä¼šé‡‡ç”¨ AMD æˆ– CMDï¼Œç›®å‰å·²ç»æ”¾å¼ƒï¼‰ã€‚

# ä¸‰ã€<strike>AMDÂ ğŸ˜…</strike>

## 1ã€è®¤è¯†

1ï¼‰AMD å…¨ç§° Asynchronous Module Definitionï¼ˆå¼‚æ­¥æ¨¡å—å®šä¹‰ï¼‰çš„ç¼©å†™

2ï¼‰AMD å¼‚æ­¥åŠ è½½æ¨¡å—

3ï¼‰AMD è§„èŒƒæ—©äº CommonJSï¼Œä½†æ˜¯ CommonJS ç›®å‰ä¾ç„¶åœ¨è¢«ä½¿ç”¨ï¼Œè€ŒAMDä½¿ç”¨çš„è¾ƒå°‘äº†

## 2ã€å®ç°

AMD å®ç°çš„æ¯”è¾ƒå¸¸ç”¨çš„åº“æ˜¯ [require.js](https://github.com/requirejs/requirejs) å’Œ [curl.js](https://github.com/cujojs/curl)

require.js ä½¿ç”¨æ¡ˆä¾‹ï¼š

1ï¼‰ä¸‹è½½ [require.js](https://github.com/requirejs/requirejs/blob/master/require.js)

2ï¼‰ä½¿ç”¨

![image-20240206015941362](https://not-have.github.io/file/images/image-20240206015941362.png)

[demo](https://github.com/Not-have/practise/tree/main/js/%E6%A8%A1%E5%9D%97%E5%8C%96/AMD)

# å››ã€<strike>CMD ğŸ˜…</strike>

## 1ã€è®¤è¯†

1ï¼‰CMD æ˜¯ Common Module Definitionï¼ˆé€šç”¨æ¨¡å—å®šä¹‰ï¼‰çš„ç¼©å†™

2ï¼‰é‡‡ç”¨äº†å¼‚æ­¥åŠ è½½æ¨¡å—ï¼Œä½†æ˜¯å®ƒå°† CommonJS çš„ä¼˜ç‚¹å¸æ”¶äº†è¿‡æ¥

## 2ã€å®ç°

CMD å®ç°çš„æ¯”è¾ƒå¸¸ç”¨çš„åº“æ˜¯ [SeaJS](https://github.com/seajs/seajs)

SeaJS ä½¿ç”¨æ¡ˆä¾‹ï¼š

1ï¼‰ä¸‹è½½ [SeaJS](https://github.com/seajs/seajs/blob/master/dist/sea.js)

2ï¼‰ä½¿ç”¨

![image-20240206022803210](https://not-have.github.io/file/images/image-20240206022803210.png)

[demo](https://github.com/Not-have/practise/tree/main/js/%E6%A8%A1%E5%9D%97%E5%8C%96/CMD)

# äº”ã€ES Module ğŸ’¡

[MDN | JavaScript æ¨¡å—](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules)

## 1ã€è®¤è¯†

1ï¼‰é‡‡ç”¨ç¼–è¯‘æœŸçš„é™æ€åˆ†æï¼Œå¹¶ä¸”ä¹ŸåŠ å…¥äº†åŠ¨æ€å¼•ç”¨çš„æ–¹å¼

2ï¼‰å—é‡‡ç”¨exportå’Œimportå…³é”®å­—æ¥å®ç°æ¨¡å—åŒ–

3ï¼‰é‡‡ç”¨ES Moduleå°†è‡ªåŠ¨é‡‡ç”¨ä¸¥æ ¼æ¨¡å¼ï¼šuse strict

## 2ã€åŸºç¡€ä½¿ç”¨

![image-20240206024019095](https://not-have.github.io/file/images/image-20240206024019095.png)

[demo](https://github.com/Not-have/practise/tree/main/js/%E6%A8%A1%E5%9D%97%E5%8C%96/ES%20Module/%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8)

## 3ã€å¯¼å‡ºæ–¹å¼

```javascript
/**
 * å¯¼å‡ºçš„ç¬¬ä¸€ç§æ–¹å¼
 */
export const name1 = "æˆ‘æ˜¯ name1";

/**
 * å¯¼å‡ºçš„ç¬¬äºŒç§æ–¹å¼
 */
const name2 = "æˆ‘æ˜¯ name2";
export { // é‡Œé¢å¯å†™å¤šä¸ª
    name2
};

/**
 * å¯¼å‡ºçš„ç¬¬ä¸‰ç§æ–¹å¼ï¼ˆèµ·åˆ«åï¼‰
 * ä¸å¸¸ç”¨
 */
const name3 = "æˆ‘æ˜¯ name3";
export { // é‡Œé¢å¯å†™å¤šä¸ª
    name3 as name3Alias
};
```

![image-20240206025759920](https://not-have.github.io/file/images/image-20240206025759920.png)

[demo](https://github.com/Not-have/practise/tree/main/js/%E6%A8%A1%E5%9D%97%E5%8C%96/ES%20Module/%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8)

## 4ã€å¯¼å…¥æ–¹å¼

```javascript
/**
 * 1ã€æ™®é€šå¯¼å…¥
 */
/*
import {
    name1,
    name2,
    name3Alias
} from "./test.js"; // å¿…é¡»åŠ  â€.jsâ€œ

console.log(name1);
console.log(name2);
console.log(name3Alias);
*/
/**
 * 2ã€èµ·åˆ«åï¼ˆå¯¼å‡ºæ—¶èµ·åˆ«åçš„æƒ…å†µå¾ˆå°‘ï¼Œä¸€ç‰ˆéƒ½æ˜¯åœ¨è¿™èµ·åˆ«åï¼‰
 */
/*
import {
    name1 as name1Alias,
    name2 as name2Alias,
    name3Alias as name3
} from "./test.js";

console.log(name1Alias);
console.log(name2Alias);
console.log(name3);
 */
/**
 * 3ã€å°†å¯¼å…¥çš„å†…å®¹æ”¾åˆ°ä¸€ä¸ªæ ‡è¯†ç¬¦ä¸­
 * è¯­æ³•ï¼šimport * as åå­— from './test.js';
 */
import * as all from './test.js';

console.log(all);
console.log(all.name1);
console.log(all.name2);
console.log(all.name3Alias);
```

![image-20240206030553646](https://not-have.github.io/file/images/image-20240206030553646.png)

[demo](https://github.com/Not-have/practise/tree/main/js/%E6%A8%A1%E5%9D%97%E5%8C%96/ES%20Module/%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8)

## 5ã€æ··åˆä½¿ç”¨

```javascript
/**
 * å¯¼å…¥å¯¼å‡ºç»“åˆä½¿ç”¨
 * ä»£ç è§„èŒƒï¼š
 * åœ¨è¿™ç»Ÿä¸€å‡ºå£
 * ä½¿ç”¨çš„æ—¶å€™ï¼Œåªéœ€è¦å®šä½åˆ°è¿™ä¸ªæ–‡ä»¶å°±å¥½
 */

/**
 * ç¬¬ä¸€ç§å¯¼å‡ºæ–¹å¼
 */
/*
import {
    add,
    reduce
} from './test-01.js';
import {
    formattedDate
} from "./test-02.js";

export {
    add,
    reduce,
    formattedDate
};
 */

/**
 * ç¬¬äºŒç§å¯¼å‡ºæ–¹å¼ï¼ˆæ¨èï¼‰
 * ç®€åŒ–äº†ä¸Šé¢çš„ä»£ç 
 */
/*
export {
    add,
    reduce
} from './test-01.js';
export {
    formattedDate
} from "./test-02.js";
*/

/**
 * ç¬¬ä¸‰ç§å¯¼å‡ºæ–¹å¼
 * åªæœ‰å½“å‰æ–‡ä»¶ä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½å¯¼å‡ºæ—¶ä½¿ç”¨ï¼Œè´Ÿè´£ä¸è¦ä½¿ç”¨
 */
export * from './test-01.js';
export * from "./test-02.js";
```

![image-20240206032702639](https://not-have.github.io/file/images/image-20240206032702639.png)

[demo](https://github.com/Not-have/practise/tree/main/js/%E6%A8%A1%E5%9D%97%E5%8C%96/ES%20Module/%E6%B7%B7%E5%90%88%E4%BD%BF%E7%94%A8)

## 6ã€default

![image-20240206034507885](https://not-have.github.io/file/images/image-20240206034507885.png)

[demo](https://github.com/Not-have/practise/tree/main/js/%E6%A8%A1%E5%9D%97%E5%8C%96/ES%20Module/default)

## 7ã€export default ğŸ”

å½“æ–‡ä»¶å¤¹ä¸­æ–‡ä»¶å…¨æ˜¯ export default å¯¼å‡ºæ—¶ï¼Œç»Ÿä¸€å‡ºå£å¤„çš„å†™æ³•è§„èŒƒã€‚

![image-20240206041123768](https://not-have.github.io/file/images/image-20240206041123768.png)

[demo](https://github.com/Not-have/practise/tree/main/js/%E6%A8%A1%E5%9D%97%E5%8C%96/ES%20Module/export%20default)

## 8ã€import å‡½æ•°

import å¯¼å…¥çš„æ–‡ä»¶è§£æå®Œä¹‹å‰ï¼Œä»–ä¸‹é¢çš„ä»£ç éƒ½æ˜¯ä¸ä¼šè¿è¡Œçš„ã€‚

å¸Œæœ› `import {æ ‡è¯†ç¬¦åˆ—è¡¨} from 'æ¨¡å—';` å¼‚æ­¥è§£æçš„æ–¹æ³•ï¼š

æ³¨ï¼šåœ¨å¯¼å‡ºï¼ˆ`import`ï¼‰å¤„ä¸å…è®¸ä¿®æ”¹å€¼ã€‚

![image-20240206035542957](https://not-have.github.io/file/images/image-20240206035542957.png)

## 9ã€è§£ææµç¨‹

[æ–‡æ¡£](https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/)

# åã€CommonJS å’Œ ES Module æ··åˆä½¿ç”¨

æ³¨ï¼šâ‘  æµè§ˆå™¨ä¸­ä¸å¯ä»¥ï¼›

â€‹        â‘¡ node ä¸­å¯ä»¥ï¼›

â€‹        â‘¢ webpack ä¸­å¯ä»¥ã€‚

åŸºäº webpack [demo](https://github.com/Not-have/practise/tree/main/js/%E6%A8%A1%E5%9D%97%E5%8C%96/%E7%9B%B8%E4%BA%92%E5%BC%95%E7%94%A8)ã€‚

